<div *ngIf="!initialLoading; else spinner">
  <div class="row">
    <div class="col-12 col-md-6">
      <nb-card>
        <nb-card-header>
          {{address.address}}
        </nb-card-header>
        <nb-list>
          <nb-list-item>
            <div class="col-md-4">
              Balance
            </div>
            <div class="col-md-8">
              {{address.etpBalance | decimals : [18,18]}} ETP
            </div>
          </nb-list-item>
          <nb-list-item>
            <div class="col-md-4">
              Value
            </div>
            <a class="col-md-8">
              {{ address.etpBalance*price.current_USD | decimals : [18,2] }} USD
            </a>
          </nb-list-item>
        </nb-list>
      </nb-card>
      <nb-card *ngIf="mstBalances.length">
        <nb-card-header>
          MST Balances
        </nb-card-header>
        <nb-list>
          <nb-list-item *ngFor="let mst of mstBalances">
            <div class="col-md-4">
              <a [routerLink]="'../'+mst.address">
                {{mst.name}}
              </a>
            </div>
            <a class="col-md-7" style="text-align: right;">
              {{mst.balance}}
            </a>
            <a class="col-md-1">
              {{mst.symbol}}
            </a>
          </nb-list-item>
        </nb-list>
      </nb-card>
    </div>
    <div *ngIf="address.contract" class="col-12 col-md-6">
      <nb-card>
        <nb-card-header>
          Smart Contract
        </nb-card-header>
        <nb-list>
          <nb-list-item *ngIf="address.contract.contractName">
            <div class="col-md-4">
              Name
            </div>
            <div class="col-md-8 break-dots">
              {{ address.contract.contractName }}
            </div>
          </nb-list-item>
          <nb-list-item *ngIf="address.contract.logoURI">
            <div class="col-md-4">
              Icon
            </div>
            <div class="col-md-8 break-dots">
              <img [src]="address.contract.logoURI" [alt]="'icon '+address.contract.contractName" class="contract-icon">
            </div>
          </nb-list-item>
          <nb-list-item>
            <div class="col-md-4">
              Creation Transaction
            </div>
            <a class="col-md-8 break-dots mono" [routerLink]="'../../tx/'+address.contract.creationTransaction.hash">
              {{ address.contract.creationTransaction.hash }}
            </a>
          </nb-list-item>
          <nb-list-item>
            <div class="col-md-4">
              Creator
            </div>
            <a class="col-md-8 break-dots mono"
              [routerLink]="'../../address/'+address.contract.creationTransaction.from">
              {{ address.contract.creationTransaction.from }}
            </a>
          </nb-list-item>
          <nb-list-item>
            <div class="col-md-4">
              Created At
            </div>
            <div class="col-md-8 break-dots">
              {{ address.contract.creationTransaction.confirmedAt * 1000 | date : 'medium' }}
            </div>
          </nb-list-item>
        </nb-list>
      </nb-card>
    </div>
    <div *ngIf="!address.contract" class="col-12 col-md-6">
      <nb-card>
        <nb-card-header>
          QR Code
        </nb-card-header>
        <nb-card-body>
          <ngx-qrcode [value]="address.address" cssClass="qrcode">
          </ngx-qrcode>
        </nb-card-body>
      </nb-card>
    </div>
  </div>

  <div class="row">
    <div class="col-12">
      <nb-card>
        <nb-tabset (changeTab)="onChangeTab($event)">
          <nb-tab class="noPadding" tabTitle="Transactions" [tabId]="TAB_IDS.TRANSACTIONS">
            <nb-list *ngIf="!(transactions && transactions.length > 0)">
              <nb-list-item>
                No transactions for this address
              </nb-list-item>
            </nb-list>
            <!--Display large screens-->
            <nb-list *ngIf="transactions && transactions.length > 0" infiniteScroll [infiniteScrollDistance]="2"
              [infiniteScrollThrottle]="80" (scrolled)="scroll()" class="d-none d-md-block">
              <nb-list-item>
                <div class="col-md-4">
                  Transaction
                </div>
                <div class="col-md-1 break-dots">
                </div>
                <div class="col-md-1 break-dots">
                </div>
                <div class="col-md-4 break-dots">
                  Counterparty
                </div>
                <div class="col-md-2" style="text-align: right;">
                  Date
                </div>
              </nb-list-item>
              <nb-list-item *ngFor="let tx of transactions">
                <a class="col-md-4 break-dots mono" [routerLink]="'../../tx/'+tx.hash">
                  {{ tx.hash }}
                </a>
                <div class="col-md-1">
                  <div *ngIf="tx.value && tx.value > 0">
                    <nb-badge text="IN" status="success"
                      *ngIf="tx.from !== address.address && tx.to == address.address"></nb-badge>
                    <nb-badge text="OUT" status="danger"
                      *ngIf="tx.from == address.address && tx.to !== address.address"></nb-badge>
                    <nb-badge text="SELF" status="info" *ngIf="tx.from == address.address && tx.to == address.address">
                    </nb-badge>
                  </div>
                  <div *ngIf="!(tx.value && tx.value > 0)">
                    <nb-badge *ngIf="tx.to" status="warning" text="CALL"></nb-badge>
                    <nb-badge *ngIf="!tx.to" status="control" text="DEPLOY"></nb-badge>
                  </div>
                </div>
                <div class="col-md-1" style="text-align: center;">
                  <div *ngIf="tx.value && tx.value > 0">{{ tx.value | decimals : [18, 6]}} ETP</div>
                  <nb-icon [icon]="'arrow-forward-outline'"></nb-icon>
                </div>
                <div class="col-md-4 break-dots mono">
                  <a *ngIf="tx.from === address.address && tx.to !== address.address" [routerLink]="'../'+tx.to">
                    {{tx.to}}
                  </a>
                  <a *ngIf="tx.from !== address.address && tx.to == address.address" [routerLink]="'../'+tx.from">
                    {{tx.from}}</a>
                  <a *ngIf="tx.from === address.address && tx.to == address.address" [routerLink]="'../'+tx.to">
                    {{tx.to}}
                  </a>
                </div>
                <div class="col-md-2" style="text-align: right;">
                  {{ tx.confirmedAt * 1000 | date : 'short'}}
                </div>
              </nb-list-item>
            </nb-list>
            <!--Display small screens-->
            <nb-list class="col-12 d-md-none small-tx-list">
              <nb-list-item *ngFor="let tx of transactions" class="row small-tx-item">
                <a class="col-12 break-dots mono padding-bottom" [routerLink]="'../tx/'+tx.hash">
                  {{ tx.hash }}
                </a>
                <div class="col-12">From:</div>
                <a class="col-12 break-dots mono" [routerLink]="'../address/'+tx.from">
                  {{ tx.from }}
                </a>
                <div class="col-12" style="text-align: center;">
                  <div *ngIf="tx.value && tx.value > 0">{{ tx.value | decimals : [18, 6]}} ETP</div>
                  <nb-icon [icon]="'arrow-forward-outline'"></nb-icon>
                </div>
                <div class="col-12" style="text-align: right;">To:</div>
                <a class="col-md-12 break-dots mono padding-bottom" style="text-align: right;"
                  [routerLink]="'../address/'+tx.to">
                  {{ tx.to }}
                </a>
                <div class="col-6">
                  Block
                  <a [routerLink]="'../block/'+tx.blockNumber">
                    {{ tx.blockNumber }}
                  </a>
                </div>

                <div class="col-6" style="text-align: right;">
                  {{ tx.confirmedAt * 1000 | date : 'short'}}
                </div>
              </nb-list-item>
            </nb-list>
          </nb-tab>
          <nb-tab *ngIf="mstTransfers && mstTransfers.length > 0" class="noPadding" tabTitle="MST Transfers">
            <!--Display large screens-->
            <nb-list infiniteScroll [infiniteScrollDistance]="2" [infiniteScrollThrottle]="0" (scrolled)="scroll()"
              class="d-none d-md-block">
              <nb-list-item>
                <div class="col-md-4 break-dots">
                  Transaction
                </div>
                <div class="col-md-1 break-dots">
                </div>
                <div class="col-md-1 break-dots">
                </div>
                <div class="col-md-4 break-dots">
                  Counterparty
                </div>
                <div class="col-md-2" style="text-align: right;">
                  Date
                </div>
              </nb-list-item>
              <nb-list-item *ngFor="let tx of mstTransfers">
                <a class="col-md-4 break-dots mono" [routerLink]="'../../tx/'+tx.transactionHash">
                  {{ tx.transactionHash }}
                </a>
                <div class="col-md-1">
                  <div *ngIf="tx.value && tx.value > 0">
                    <nb-badge text="IN" status="success"
                      *ngIf="tx.from !== lowercaseAddress && tx.to == lowercaseAddress"></nb-badge>
                    <nb-badge text="OUT" status="danger"
                      *ngIf="tx.from == lowercaseAddress && tx.to !== lowercaseAddress"></nb-badge>
                    <nb-badge text="SELF" status="info"
                      *ngIf="tx.from == lowercaseAddress && tx.to == lowercaseAddress"></nb-badge>
                  </div>
                  <div *ngIf="!(tx.value && tx.value > 0)">
                    <nb-badge *ngIf="tx.to" status="warning" text="CALL"></nb-badge>
                    <nb-badge *ngIf="!tx.to" status="control" text="DEPLOY"></nb-badge>
                  </div>
                </div>
                <div class="col-md-1" style="text-align: center;">
                  <div *ngIf="tx.value && tx.value > 0">{{ tx.value | decimals : [tx.tokenInfo.decimals, 6]}}
                    {{tx.tokenInfo.symbol}}</div>
                  <div>
                    <nb-icon [icon]="'arrow-forward-outline'"></nb-icon>
                  </div>
                </div>
                <div class="col-md-4 break-dots mono">
                  <a *ngIf="tx.from === lowercaseAddress && tx.to !== lowercaseAddress" [routerLink]="'../'+tx.to">
                    {{tx.to}}
                  </a>
                  <a *ngIf="tx.from !== lowercaseAddress && tx.to == lowercaseAddress" [routerLink]="'../'+tx.from">
                    {{tx.from}}</a>
                  <a *ngIf="tx.from === lowercaseAddress && tx.to == lowercaseAddress" [routerLink]="'../'+tx.to">
                    {{tx.to}}
                  </a>
                </div>
                <a class="col-md-2" style="text-align: right;" [routerLink]="'../../block/'+tx.blockNumber">
                  {{ tx.confirmedAt * 1000 | date : 'short'}}
                </a>
              </nb-list-item>
            </nb-list>

            <!--Display small screens-->
            <nb-list class="col-12 d-md-none small-tx-list">
              <nb-list-item *ngFor="let tx of mstTransfers" class="row small-tx-item">
                <a class="col-12 break-dots mono padding-bottom" [routerLink]="'../tx/'+tx.transactionHash">
                  {{ tx.transactionHash }}
                </a>
                <div class="col-12">From:</div>
                <a class="col-12 break-dots mono" [routerLink]="'../address/'+tx.from">
                  {{ tx.from }}
                </a>
                <div class="col-12" style="text-align: center;">
                  <div *ngIf="tx.value && tx.value > 0">{{ tx.value | decimals : [tx.tokenInfo.decimals, 6]}}
                    {{tx.tokenInfo.symbol}}</div>
                  <nb-icon [icon]="'arrow-forward-outline'"></nb-icon>
                </div>
                <div class="col-12" style="text-align: right;">To:</div>
                <a class="col-md-12 break-dots mono padding-bottom" style="text-align: right;"
                  [routerLink]="'../address/'+tx.to">
                  {{ tx.to }}
                </a>
                <div class="col-6">
                  Block
                  <a [routerLink]="'../block/'+tx.blockNumber">
                    {{ tx.blockNumber }}
                  </a>
                </div>
                <div class="col-6" style="text-align: right;">
                  {{ tx.confirmedAt * 1000 | date : 'short'}}
                </div>
              </nb-list-item>
            </nb-list>
          </nb-tab>

          <!--   Contract related tabs   -->
          <nb-tab *ngIf="contract && contract.abi" class="noPadding" tabTitle="Functions">
            <nb-list-item *ngFor="let func of contract.abi | filter: {type: 'function'} " class="row">
              <div class="col-md-4">
                <b>{{func.name}}</b>
                <div>{{ func.constant ? 'Constant' : 'Function'}}</div>
                <div>{{func.stateMutability}}</div>
              </div>
              <div class="col-md-5">
                <mvs-contract-call [address]="address.address" [stateMutability]="func.stateMutability"
                  [abi]="contract.abi" [method]="func.name" [inputs]="func.inputs"></mvs-contract-call>
              </div>
              <div class="col-md-3" style="text-align: right;">
                <div>
                  Output type
                  <div>
                    <span *ngFor="let output of func.outputs">{{output.type}} </span>
                  </div>
                </div>
              </div>
            </nb-list-item>
          </nb-tab>

          <nb-tab *ngIf="contract && contract.abi" tabTitle="Log" [tabId]="TAB_IDS.LOGS">
            <nb-select placeholder="Filter Event" style="width: 100%" (selectedChange)="logFilterSelected($event)">
              <nb-option *ngFor="let event of contract.abi | filter : {type: 'event'}" [value]="event">{{event.name}}
              </nb-option>
            </nb-select>
            <nb-list *ngIf="logs && logs.length; else noLogs" infiniteScroll [infiniteScrollDistance]="2"
              [infiniteScrollThrottle]="0" (scrolled)="scroll()" class="d-none d-md-block">
              <nb-list-item *ngFor="let log of logs" class="row">
                <div class="col-md-6">
                  <div>
                    <div>Transaction</div>
                    <a [routerLink]="'../../tx/'+log.transactionHash"
                      class="break-dots mono">{{log.transactionHash}}</a>
                  </div>
                  <div>
                    <div>Block</div>
                    <a [routerLink]="'../../block/'+log.blockHash" class="break-dots mono">{{log.blockNumber}}</a>
                  </div>
                </div>

                <div class="row col-md-6">
                  <div *ngIf="log.decoded" class="col-md-12 decoded">
                    <div class="break-word mono">{{log.decoded.signature}}</div>
                    <div *ngFor="let value of log.decoded.values" class="break-word mono row">
                      <div class="col-md-3">
                        {{value.name}}
                      </div>
                      <div class="col-md-9">
                        <span *ngIf="value.value?.hex">{{formatHexNumber(value.value.hex)}}</span>
                        <span *ngIf="!value.value?.hex">{{value.value}}</span>
                      </div>
                    </div>
                  </div>
                </div>
              </nb-list-item>
            </nb-list>
            <ng-template #noLogs>
              <div>
                No logs found
              </div>
            </ng-template>
          </nb-tab>

          <nb-tab *ngIf="address.contract && address.contract.source" class="noPadding" tabTitle="Source Code">
            <pre>
              {{'\n'+address.contract.source}}
            </pre>
          </nb-tab>

          <nb-tab *ngIf="address.contract && address.contract.bytecode" class="noPadding" tabTitle="Bytecode">
            <pre class="break-word">
              {{'\n'+address.contract.bytecode}}
            </pre>
          </nb-tab>
        </nb-tabset>
      </nb-card>
    </div>
    <div
      *ngIf="(selectedTab == TAB_IDS.TRANSACTIONS && loadingTxs) || (selectedTab == TAB_IDS.MST_TRANSFERS && loadingMstTxs) || selectedTab === TAB_IDS.LOGS && loadingLogs"
      class="loading-spinner"></div>
  </div>
</div>
<ng-template #spinner>
  <div class="loading-spinner page-spinner"></div>
</ng-template>